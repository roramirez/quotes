<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width,initial-scale=1">
        <meta name="description" content="A fully featured admin theme which can be used to build CRM, CMS, etc.">
        <meta name="author" content="Coderthemes">

        <link rel="shortcut icon" href="assets/images/favicon_1.ico">

        <title>Simulador</title>

        <!-- Plugins css-->
        <link href="../plugins/bootstrap-tagsinput/dist/bootstrap-tagsinput.css" rel="stylesheet" />
        <link href="../plugins/multiselect/css/multi-select.css"  rel="stylesheet" type="text/css" />
        <link href="../plugins/select2/select2.css" rel="stylesheet" type="text/css" />
        <link href="../plugins/bootstrap-touchspin/dist/jquery.bootstrap-touchspin.min.css" rel="stylesheet" />
        <link href="../plugins/mjolnic-bootstrap-colorpicker/dist/css/bootstrap-colorpicker.min.css" rel="stylesheet">
        <link href="../plugins/bootstrap-datepicker/dist/css/bootstrap-datepicker.min.css" rel="stylesheet">
        <link href="../plugins/bootstrap-daterangepicker/daterangepicker.css" rel="stylesheet">

        <link href="../plugins/switchery/switchery.min.css" rel="stylesheet" />
        <link href="assets/css/bootstrap.min.css" rel="stylesheet" type="text/css">
        <link href="assets/css/icons.css" rel="stylesheet" type="text/css">
        <link href="assets/css/style.css" rel="stylesheet" type="text/css">

        <script src="assets/js/modernizr.min.js"></script>

    </head>


    <body class="fixed-left">

        <!-- Begin page -->
        <div id="wrapper">

            <!-- Top Bar Start -->
            <div class="topbar">

                <!-- LOGO -->
                <div class="topbar-left">
                    <div class="text-center">
                        <a href="index.html" class="logo"><i class="mdi mdi-radar"></i> <span>CallNow.Tech</span></a>
                    </div>
                </div>

                <!-- Button mobile view to collapse sidebar menu -->
                <nav class="navbar-custom">

                    <ul class="list-inline float-right mb-0">
                   </ul>

                    <ul class="list-inline menu-left mb-0">
                    </ul>

                </nav>

            </div>
            <!-- Top Bar End -->


            <!-- Left Sidebar End -->


            <!-- ============================================================== -->
            <!-- Start right Content here -->
            <!-- ============================================================== -->
            <div class="content-page">
                <!-- Start content -->
                <div class="content">
                    <div class="container">

                        <div class="row">
                            <div class="col-sm-12">
                                <div class="card-box">
                                    <h4 class="m-t-0 m-b-20 header-title"><b>Tags Input</b></h4>


        <div class="row">
            <div class="col-md-12">
                <h3>Simula tu crédito aquí</h3>


                <form class="form-horizontal" role="form" >


                <div class="form-group">
                  <label class="col-2 col-form-label" for="example-email">Nombre</label>
                  <div class="col-10">
                    <input type="input" id="example-email" name="nombreCliente" class="form-control" placeholder="Nombre">
                    </div>
                  </div>
                </div>

                <div class="form-group">
                  <label class="col-2 col-form-label" for="example-email">Celular</label>
                  <div class="col-10">
                    <input type="input" id="fonoCliente" name="fonoCliente" class="form-control" placeholder="Celular">
                    </div>
                  </div>
                </div>


                   <p><strong>¿Qué tipo de tasa quieres?</strong></p>
                    <div class="form-group">
                    <div class="checkbox col-sm-5 col-sm-offset-1">
                            <label class="checkbox-inline">
                                <input type="checkbox" name="approve" value="">
                                <strong>tasa fija</strong> (UF)
                            </label>
                    </div>
                    <div class="checkbox col-sm-5 col-sm-offset-1">
                            <label class="checkbox-inline">
                                <input type="checkbox" name="approve" value="">
                                <strong>tasa fija + variable</strong> (UF)
                            </label>
                    </div>
                    </div>
                    <p><strong>¿Cuál es el valor de la propiedad?</strong></p>
                    <!--<div class="form-group">-->
                    <div class="input-group">
                        <div class="input-group-btn">
                        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">UF <span class="caret"></span></button>
                            <ul class="dropdown-menu">
                              <li><a href="#">UF</a></li>
                              <li><a href="#">$</a></li>
                            </ul>
                        </div><!-- /btn-group -->
                          <input type="text" class="form-control"id="valorpropiedad" name="valorPropiedadUf" placeholder="0">
                    </div><!-- /input-group -->
                    <!--</div>-->
                    
                    <p><strong>¿Cuál es el monto del pie que entregarás?</strong></p>
                    <!--<div class="form-group">-->
                     <div class="input-group">
                        <div class="input-group-btn">
                        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">UF <span class="caret"></span></button>
                            <ul class="dropdown-menu">
                              <li><a href="#">UF</a></li>
                              <li><a href="#">$</a></li>
                            </ul>
                        </div><!-- /btn-group -->
                          <input type="text" class="form-control"id="pie" name="valorPropiedadUf" placeholder="0">
                    </div><!-- /input-group -->
                    <!--</div>-->
                    
                    <p><strong>¿Cuál es el monto del crédito que deseas solicitar?</strong></p>
                    <!--<div class="form-group">-->
                     <div class="input-group">
                        <div class="input-group-btn">
                        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">UF <span class="caret"></span></button>
                            <ul class="dropdown-menu">
                              <li><a href="#">UF</a></li>
                              <li><a href="#">$</a></li>
                            </ul>
                        </div><!-- /btn-group -->
                          <input type="text" class="form-control"id="montocredito" name="montoCreditoUf" placeholder="0">
                    </div><!-- /input-group -->
                    <!--</div>-->
                    
                     <p><strong>¿En cuántos años deseas pagar el crédito?</strong></p>
                    <!--<div class="form-group">-->
                     <div class="input-group">
                        
                            <select class="form-control" name="anosTasaFija">
                                <option>10</option>
                                <option>12</option>
                                <option>14</option>
                                <option>16</option>
                                <option>18</option>
                                <option>20</option>
                                <option>22</option>
                                <option>24</option>
                                <option>26</option>
                                <option>28</option>
                                <option>30</option>
                            </select>
                    
                    </div><!-- /input-group -->
                    <!--</div>-->
                    
                    <div class="form-group">
                        <div class="col-md-3">
                            <button type="submit" class="btn btn-primary">Calcular</button>
                        </div>
                    </div>

                </form>
                
                
            </div>

        </div>



                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                    <!-- end container -->
                </div>
                <!-- end content -->

                <footer class="footer text-right">
                    2017 © CallNow.Tech
                </footer>

            </div>
            <!-- ============================================================== -->
            <!-- End Right content here -->
            <!-- ============================================================== -->


            <!-- Right Sidebar -->
            <div class="side-bar right-bar">
                <div class="">
                    <ul class="nav nav-tabs tabs-bordered nav-justified">
                        <li class="nav-item">
                            <a href="#home-2" class="nav-link active" data-toggle="tab" aria-expanded="false">
                                Activity
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#messages-2" class="nav-link" data-toggle="tab" aria-expanded="true">
                                Settings
                            </a>
                        </li>
                    </ul>
                    <div class="tab-content">
                        <div class="tab-pane fade show active" id="home-2">
                            <div class="timeline-2">
                                <div class="time-item">
                                    <div class="item-info">
                                        <small class="text-muted">5 minutes ago</small>
                                        <p><strong><a href="#" class="text-info">John Doe</a></strong> Uploaded a photo <strong>"DSC000586.jpg"</strong></p>
                                    </div>
                                </div>

                                <div class="time-item">
                                    <div class="item-info">
                                        <small class="text-muted">30 minutes ago</small>
                                        <p><a href="" class="text-info">Lorem</a> commented your post.</p>
                                        <p><em>"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam laoreet tellus ut tincidunt euismod. "</em></p>
                                    </div>
                                </div>

                                <div class="time-item">
                                    <div class="item-info">
                                        <small class="text-muted">59 minutes ago</small>
                                        <p><a href="" class="text-info">Jessi</a> attended a meeting with<a href="#" class="text-success">John Doe</a>.</p>
                                        <p><em>"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam laoreet tellus ut tincidunt euismod. "</em></p>
                                    </div>
                                </div>

                                <div class="time-item">
                                    <div class="item-info">
                                        <small class="text-muted">1 hour ago</small>
                                        <p><strong><a href="#" class="text-info">John Doe</a></strong>Uploaded 2 new photos</p>
                                    </div>
                                </div>

                                <div class="time-item">
                                    <div class="item-info">
                                        <small class="text-muted">3 hours ago</small>
                                        <p><a href="" class="text-info">Lorem</a> commented your post.</p>
                                        <p><em>"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam laoreet tellus ut tincidunt euismod. "</em></p>
                                    </div>
                                </div>

                                <div class="time-item">
                                    <div class="item-info">
                                        <small class="text-muted">5 hours ago</small>
                                        <p><a href="" class="text-info">Jessi</a> attended a meeting with<a href="#" class="text-success">John Doe</a>.</p>
                                        <p><em>"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam laoreet tellus ut tincidunt euismod. "</em></p>
                                    </div>
                                </div>
                            </div>
                        </div>


                        <div class="tab-pane" id="messages-2">

                            <div class="row m-t-20">
                                <div class="col-8">
                                    <h5 class="m-0 font-15">Notifications</h5>
                                    <p class="text-muted m-b-0"><small>Do you need them?</small></p>
                                </div>
                                <div class="col-4 text-right">
                                    <input type="checkbox" checked data-plugin="switchery" data-color="#3bafda" data-size="small"/>
                                </div>
                            </div>

                            <div class="row m-t-20">
                                <div class="col-8">
                                    <h5 class="m-0 font-15">API Access</h5>
                                    <p class="m-b-0 text-muted"><small>Enable/Disable access</small></p>
                                </div>
                                <div class="col-4 text-right">
                                    <input type="checkbox" checked data-plugin="switchery" data-color="#3bafda" data-size="small"/>
                                </div>
                            </div>

                            <div class="row m-t-20">
                                <div class="col-8">
                                    <h5 class="m-0 font-15">Auto Updates</h5>
                                    <p class="m-b-0 text-muted"><small>Keep up to date</small></p>
                                </div>
                                <div class="col-4 text-right">
                                    <input type="checkbox" checked data-plugin="switchery" data-color="#3bafda" data-size="small"/>
                                </div>
                            </div>

                            <div class="row m-t-20">
                                <div class="col-8">
                                    <h5 class="m-0 font-15">Online Status</h5>
                                    <p class="m-b-0 text-muted"><small>Show your status to all</small></p>
                                </div>
                                <div class="col-4 text-right">
                                    <input type="checkbox" checked data-plugin="switchery" data-color="#3bafda" data-size="small"/>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
            <!-- /Right-bar -->


        <div id="remote_stream" class="col-md-8 hide">
          <video id="remote" class="" autoplay hidden=true poster="" src="/320x240.ogg">
            Tu navegador no implementa el elemento <code>video</code>.
          </video>
        </div>



            <div class="row chat-window col-xs-5 col-md-3" id="chat_window_1" style="margin-left:10px;">
              <div class="col-xs-12 col-md-12">
                <div class="panel panel-default">
                  <div class="panel-heading top-bar">
                    <div class="col-md-8 col-xs-8">
                      <h3 class="panel-title">Web2Call</h3>
                    </div>
                    <div class="col-md-4 col-xs-4" style="text-align: right;">
                      <a href="#"><span id="minim_chat_window" class="glyphicon icon_minim btn-xs panel-collapsed glyphicon-plus"></span></a>
                    </div>
                  </div>
                <div style="display: none;" class="panel-body msg_container_base">

                  <div class="panel-footer">
                    <div class="input-group">

                          <div id="main-wrapper" class="phone_wrapper" style="display:none">
                            <section role="main">
                              <div class="dialPad compact">
                                <div class="number"></div>
                                  <div class="dials">
                                    <ol>
                                      <li class="digits">
                                        <p><strong>1</strong></p>
                                      </li>
                                      <li class="digits">
                                        <p><strong>2</strong><sup>abc</sup></p>
                                      </li>
                                      <li class="digits">
                                        <p><strong>3</strong><sup>def</sup></p>
                                      </li>
                                      <li class="digits">
                                        <p><strong>4</strong><sup>ghi</sup></p>
                                      </li>
                                      <li class="digits">
                                        <p><strong>5</strong><sup>jkl</sup></p>
                                      </li>
                                      <li class="digits">
                                        <p><strong>6</strong><sup>mno</sup></p>
                                      </li>
                                      <li class="digits">
                                        <p><strong>7</strong><sup>pqrs</sup></p>
                                      </li>
                                      <li class="digits">
                                        <p><strong>8</strong><sup>tuv</sup></p>
                                      </li>
                                      <li class="digits">
                                        <p><strong>9</strong><sup>wxyz</sup></p>
                                      </li>
                                      <li class="digits">
                                        <p><strong>*</strong></p>
                                      </li>
                                      <li class="digits">
                                        <p><strong>0</strong><sup>+</sup></p>
                                      </li>
                                      <li class="digits">
                                        <p><strong>#</strong></p>
                                      </li>
                                      <li class="digits">
                                        <p><strong><i class=""></i></strong> <sup></sup></p>
                                      </li>
                                      <li class="digits">
                                        <p><strong><i class=""></i></strong> <sup></sup></p>
                                      </li>
                                      <li class="digits pad-action">
                                        <p><strong><i class="icon-phone icon-large"></i></strong> <sup>Hangup</sup></p>
                                      </li>
                                    </ol>
                                  </div>
                                </div>
                              </section>
                            </div>
                            <span class="input-group-btn">
                            <button class="btn btn-primary btn-sm" id="btn-call">Hablar Aqui</button>
                            <button class="btn btn-primary btn-sm" id="btn-ctc">Llamame</button>
                      </span>
                    </div>
                 </div>
              </div>
            </div>
            </div>
          </div>
        </div>




        </div>
        <!-- END wrapper -->








        <script>
            var resizefunc = [];
        </script>

        <!-- Plugins  -->
        <script src="assets/js/jquery.min.js"></script>
        <script src="assets/js/tether.min.js"></script>
        <script src="assets/js/bootstrap.min.js"></script>
        <script src="assets/js/detect.js"></script>
        <script src="assets/js/fastclick.js"></script>
        <script src="assets/js/jquery.slimscroll.js"></script>
        <script src="assets/js/jquery.blockUI.js"></script>
        <script src="assets/js/waves.js"></script>
        <script src="assets/js/wow.min.js"></script>
        <script src="assets/js/jquery.nicescroll.js"></script>
        <script src="assets/js/jquery.scrollTo.min.js"></script>
        <script src="../plugins/switchery/switchery.min.js"></script>

        <script src="../plugins/bootstrap-tagsinput/dist/bootstrap-tagsinput.min.js"></script>
        <script type="text/javascript" src="../plugins/multiselect/js/jquery.multi-select.js"></script>
        <script type="text/javascript" src="../plugins/jquery-quicksearch/jquery.quicksearch.js"></script>
        <script src="../plugins/select2/select2.min.js" type="text/javascript"></script>
        <script src="../plugins/bootstrap-touchspin/dist/jquery.bootstrap-touchspin.min.js" type="text/javascript"></script>
        <script src="../plugins/bootstrap-inputmask/bootstrap-inputmask.min.js" type="text/javascript"></script>

        <script src="../plugins/moment/moment.js"></script>
        <script src="../plugins/mjolnic-bootstrap-colorpicker/dist/js/bootstrap-colorpicker.min.js"></script>
        <script src="../plugins/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js"></script>
        <script src="../plugins/bootstrap-daterangepicker/daterangepicker.js"></script>

        <script src="assets/pages/jquery.form-advanced.init.js"></script>

        <!-- Custom main Js -->
        <script src="assets/js/jquery.core.js"></script>
        <script src="assets/js/jquery.app.js"></script>

    <script>
      $( "form" ).submit(function( event ) {

      data = $('form').serializeArray()

      $.ajax({
          url: '/simulation',
          data:  JSON.stringify(data),
          type: 'POST',
          success: function(data) {
            console.log(data);
            // here show me result
          },
          dataType: 'json'
        });
        event.preventDefault();
      });


    </script>










    </div>
    <!-- end: Container -->

    </div>
  <!-- end: Wrapper  -->

  <!-- start: Java Script -->
  <!-- Placed at the end of the document so the pages load faster -->
  <script src="/js/jquery-1.8.2.js"></script>
  <script src="/js/bootstrap-2.2.1.js"></script>
  <script defer="defer" src="/js/web2call.js"></script>
  <link href="/css/web2call.css" rel="stylesheet">
  <link href="/css/phone.css" rel="stylesheet">
  <script src="/js/jssip.js"></script>
  <!-- end: Java Script -->

  <script>
    JsSIP.debug.enable('JsSIP:*');  // Debug
    var call;
    var session;
    var remote =  document.getElementById('remote');
    var player = document.createElement("audio");
    var ringing = false;
    var configuration = {}
    $('#btn-call').on('click', function() {
        $(this).html('Llamando...');
        $.getJSON('/new_subscriber', function(data) {
        //$.getJSON('https://' +  location.host + '/new_subscriber', function(data) {

            configuration = {
              'ws_servers': data.ws,
              'uri':        data.uri,
              'password':   data.password,
              'session_timers': false,
            };
	    console.log(configuration);
            ua = new JsSIP.UA(configuration);
            session = ua.start();
            var ringing = false;
            callToCentral();

       });

    });


    // Register callbacks to desired call events
    var eventHandlers = {
    'progress': function(e){
     console.log('call is in progress');
    },
    'connecting': function(e){
     console.log('call is connecting');
     playSound('/sounds/outgoing-call2.ogg');
     $('#btn-call').prop('disabled', true);
     $('#btn-call').addClass('disabled');
     setRinging(1);
    },
    'failed': function(e){
      console.log(e);
      console.log('call failed with cause: '+ e.cause);
      setRinging(0);
      playSound('/sounds/nan');
      resetPhone();
    },
    'ended': function(e){
      console.log(e);
      console.log('call ended with cause: '+ e.cause);
      resetPhone();
    },
    'confirmed': function(e){
      console.log('call confirmed');
      $('#main-wrapper').show();
      $('#btn-call').hide();
      setRinging(0);
      playSound('/sounds/nan');
    },
    'addstream': function(e){
      var stream = e.stream;
      console.log('remote stream added');
      // Attach remote stream to remoteView
      remote = JsSIP.rtcninja.attachMediaStream(remote, stream);
    }
   };


    function callToCentral() {

        var mediaConstraints = { audio: true, video: false };

        // call to other
        var options = {
            'eventHandlers': eventHandlers,
            'mediaConstraints': mediaConstraints,
            'pcConfig': {
            'iceServers': [
              { 'urls': 'stun:stun.l.google.com:19302' }
             ]
            },
        };


        //call = ua.call('sip:XXXXXXX@' + configuration.uri.split('@')[1], options);
        call = ua.call('sip:central@' + configuration.uri.split('@')[1], options);

        // NewDTMF
        call.on('newDTMF',function(e) { 
           playSound("/sounds/dialpad/" + e.dtmf.tone + ".ogg");
        });

    }

    function resetPhone() {
        $('#btn-call').html('Hablar Aquí');
        $('.number').html("")
        $('#main-wrapper').hide();
        $('#btn-call').show();
        $('#btn-call').removeClass('disabled');
        $('#btn-call').prop('disabled', false);
    }

    function playSound(sound_file) {
        player.setAttribute("src", sound_file);
        player.play();
    }


    function setRinging(value){
        ringing = value;
    }
    function doRinging(){
        if (ringing == true) {
            playSound('/sounds/outgoing-call2.ogg');
        }
    }


    setInterval(function () {
        //doRinging();
	 console.log("testing...");
    }, 3000 );



    var dials = $(".dials ol li");
    var index;
    var number = $(".number");
    var total;

    dials.click(function(){
        index = dials.index(this);
        var n;
        if(index == 9) {
            n = "*";
        } else if (index == 10) {    
            n = "0";
        } else if (index == 11) {
            n = "#";
        } else if (index == 12){
            n = '';
            number.empty();
        } else if (index == 13) {
            total = number.text();
            total = total.slice(0,-1);
            number.empty();
            n = total;
        } else if (index == 14) {
            // hangup call
            console.log('Hangup');
            call.terminate();
        } else {
            n = index+1;
        }
        number.append(n);
        if (n != '') {
            console.log(n);
            call.sendDTMF(n)
        }
    });





    $('#btn-ctc').on('click', function() {
        $(this).html('Te vamos a llamar...');

      var r_data = {
      "popup_uuid":"e5c98214-d0f6-11e1-8c30-001d09ef4a24", 
      "phonenumber": $('#fonoCliente').val(),
      "areacode":"9",
      "country_code":"56",
      "security_token": "",
      "adicional": 
      {
        "Nombre": "Juan",
        "Email": "jperez@mt2015.com"
      },

      "src_number" : {"areacode": 9, "phonenumber": "XXXXXXX"}
    }

	$.ajax({
	  url: 'https://clickandtalk.medularis.com/calls/manage/api',
	  data: r_data,
	  type: 'GET',
	  success: function(data) {
	    console.log(data);
	   },
	  dataType: 'json'
	});


    });


  </script>






    </body>
</html>
